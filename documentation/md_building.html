<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MFC: Building</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
// This file is set as MATHJAX_CODEFILE in the Doxyfile. It configures how
// MathJax renders expressions in Markdown so that it is consistent with GitHub.
MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath:  [ ['$',  '$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true,
      ignoreClass: "line" // Ignore code blocks: https://web.archive.org/web/20120430100225/http://www.mathjax.org/docs/1.1/options/tex2jax.html
    },
    "HTML-CSS": {
      fonts: ["TeX"]
    }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MFC
   </div>
   <div id="projectbrief">High-fidelity multiphase flow simulation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_building.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Building </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md2"></a>
Build Environment</h1>
<p>To fetch, build, and run MFC and its dependencies on a UNIX-like system, you must have installed common utilities such as GNU's Make, Python3, its development headers and libraries, a C/C++ compiler (GCC, NVHPC, etc., but <em>not Clang</em>), and an MPI wrapper (like Open MPI). Below are some commands for popular operating systems and package managers.</p>
<p><a href="https://www.anaconda.com/">Anaconda</a> may interfere with the building process. If an issue arises, you can either uninstall the affected Anaconda packages, change the ordering of directory paths in your <code>$PATH</code>, or make aliases to the correct binaries.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
*nix</h2>
<ul>
<li><b>Via <a href="https://wiki.debian.org/Aptitude">Aptitude</a>:</b></li>
</ul>
<div class="fragment"><div class="line">$ sudo apt update</div>
<div class="line">$ sudo apt upgrade</div>
<div class="line">$ sudo apt install tar wget make cmake gcc g++ \</div>
<div class="line">                   python3 python3-dev         \</div>
<div class="line">                   &quot;openmpi-*&quot; libopenmpi-dev</div>
</div><!-- fragment --><ul>
<li><b>Via <a href="https://wiki.archlinux.org/title/pacman">Pacman</a>:</b></li>
</ul>
<div class="fragment"><div class="line">$ sudo pacman -Syu</div>
<div class="line">$ sudo pacman -S base-devel coreutils  \</div>
<div class="line">                 git ninja gcc-fortran \</div>
<div class="line">                 cmake openmpi python3 \</div>
<div class="line">                 python-pip openssh    \</div>
<div class="line">                 python-virtualenv vim \</div>
<div class="line">                 wget tree</div>
</div><!-- fragment --><p>If you wish to build MFC using <a href="https://developer.nvidia.com/hpc-sdk">NVidia's NVHPC SDK</a>, follow the instructions <a href="https://developer.nvidia.com/nvidia-hpc-sdk-downloads">here</a>.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Windows</h2>
<p>On Windows, you can either use Intel Compilers with the standard Microsoft toolchain, <a href="https://docs.docker.com/get-docker/">Docker</a> or the <a href="https://docs.microsoft.com/en-us/windows/wsl/">Windows Subsystem for Linux (WSL)</a> for a Linux experience.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Windows + Intel (Native)</h3>
<p>Install the latest version of:</p><ul>
<li><a href="https://visualstudio.microsoft.com/">Microsoft Visual Studio Community</a></li>
<li><a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/base-toolkit-download.html">Intel® oneAPI Base Toolkit</a></li>
<li><a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit-download.html">Intel® oneAPI HPC Toolkit</a></li>
</ul>
<p>Then, in order to initialize your development environment, open a terminal window and run: </p><div class="fragment"><div class="line">&quot;C:\Program Files (x86)\Intel\oneAPI\setvars.bat&quot;</div>
</div><!-- fragment --><p>To follow this guide, please replace <code>./mfc.sh</code> with <code>mfc.bat</code> when running any commands. <code>./mfc.sh</code> is intended Unix-like systems. You will also have access to the <code>.sln</code> Microsoft Visual Studio solution files for an IDE (Integrated Development Environment).</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Windows + Docker</h3>
<p>See the instructions in the "Docker (Cross-Platform)" section of this document.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
Windows + WSL</h3>
<p>Install the latest version of the <a href="https://docs.microsoft.com/en-us/windows/wsl/">Windows Subsystem for Linux (WSL)</a> as well as a distribution such as Ubuntu which can be found <a href="https://apps.microsoft.com/store/detail/ubuntu/9PDXGNCFSCZV">here</a>. Acquiring an interactive session is as simple as typing <code>wsl</code> in your command prompt, or alternatively, selecting the distribution from the dropdown menu available in the <a href="https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701">Microsoft Terminal</a>.</p>
<p>You can now follow the appropriate instructions for your distribution.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
MacOS (x86 and Apple Silicon)</h2>
<p><b>Note:</b> macOS remains the most difficult platform to consistently compile MFC on. If you run into issues, we suggest you try using Docker (instructions above).</p>
<ul>
<li><b>MacOS v10.15 (Catalina) or newer [ZSH]</b> (Verify with <code>echo $SHELL</code>)</li>
</ul>
<div class="fragment"><div class="line">$ touch ~/.zshrc</div>
<div class="line">$ open ~/.zshrc</div>
</div><!-- fragment --><ul>
<li><b>Older than MacOS v10.15 (Catalina) [BASH]</b> (Verify with <code>echo $SHELL</code>)</li>
</ul>
<div class="fragment"><div class="line">$ touch ~/.bash_profile</div>
<div class="line">$ open ~/.bash_profile</div>
</div><!-- fragment --><p>An editor should open. Please paste the following lines into it before saving the file. If you wish to use a version of GNU's GCC other than 11, modify the first assignment. These lines ensure that LLVM's Clang, and Apple's modified version of GCC, won't be used to compile MFC. Further reading on <code>open-mpi</code> incompatibility with <code>clang</code>-based <code>gcc</code> on macOS: <a href="https://stackoverflow.com/questions/27930481/how-to-build-openmpi-with-homebrew-and-gcc-4-9">here</a>. We do <em>not</em> support <code>clang</code> due to conflicts with our Silo dependency.</p>
<div class="fragment"><div class="line"># === MFC MPI Installation ===</div>
<div class="line">export MFC_GCC_VER=11</div>
<div class="line">export OMPI_MPICC=gcc-$MFC_GCC_VER</div>
<div class="line">export OMPI_CXX=g++-$MFC_GCC_VER</div>
<div class="line">export OMPI_FC=gfortran-$MFC_GCC_VER</div>
<div class="line">export CC=gcc-$MFC_GCC_VER</div>
<div class="line">export CXX=g++-$MFC_GCC_VER</div>
<div class="line">export FC=gfortran-$MFC_GCC_VER</div>
<div class="line"># === MFC MPI Installation ===</div>
</div><!-- fragment --><p><b>Close the open editor and terminal window</b>. Open a <b>new terminal</b> window before executing the commands bellow.</p>
<div class="fragment"><div class="line">$ brew install wget make python make cmake coreutils gcc@$MFC_GCC_VER</div>
<div class="line">$ HOMEBREW_MAKE_JOBS=$(nproc) brew install --cc=gcc-$MFC_GCC_VER --verbose --build-from-source open-mpi</div>
</div><!-- fragment --><p>They will download the dependencies MFC requires to build itself. <code>open-mpi</code> will be compiled from source, using the version of GCC we specified above with the environment variables <code>HOMEBREW_CC</code> and <code>HOMEBREW_CXX</code>. Building this package might take a while.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Docker (Cross-Platform)</h2>
<p>Docker is a lightweight, cross-platform, and performant alternative to Virtual Machines (VMs). We build a Docker Image that contains the packages required to build and run MFC on your local machine.</p>
<p>First install Docker and Git:</p><ul>
<li>Windows: <a href="https://docs.docker.com/get-docker/">Docker</a> + <a href="https://git-scm.com/downloads">Git</a>.</li>
<li>macOS: <code>brew install git docker</code> (requires <a href="https://brew.sh/">Homebrew</a>).</li>
<li>Other systems: <div class="fragment"><div class="line">$ sudo apt install git docker # Debian / Ubuntu via Aptitude</div>
<div class="line">$ sudo pacman -S git docker   # Arch Linux via Pacman</div>
</div><!-- fragment --></li>
</ul>
<p>Once Docker and Git are installed on your system, clone MFC with</p>
<div class="fragment"><div class="line">$ git clone https://github.com/MFlowCode/MFC</div>
<div class="line">$ cd MFC </div>
</div><!-- fragment --><p>To fetch the prebuilt Docker image and enter an interactive bash session with the recommended settings applied, run</p>
<div class="fragment"><div class="line">$ ./mfc.sh  docker # If on \*nix/macOS</div>
<div class="line">  .\mfc.bat docker # If on Windows</div>
</div><!-- fragment --><p>We automatically mount and configure the proper permissions in order for you to access your local copy of MFC, available at <code>~/MFC</code>. You will be logged-in as the <code>me</code> user with root permissions.</p>
<p>:warning: The state of your container is entirely transient, except for the MFC mount. Thus, any modification outside of <code>~/MFC</code> should be considered as permanently lost upon session exit.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Fetch &amp; Build</h1>
<p>MFC can be built without a helper script by directly running CMake but they (<code>mfc.sh</code> on Linux and <code>mfc.bat</code> on Windows) offer convenience features that assist in building, testing, optimization, as well as interactive and batch execution. To build MFC without a helper script, consult the <a href="CMakeLists.txt">CMakeLists.txt</a> file for a full list of options, as well as <a href="toolchain/dependencies/CMakeLists.txt">toolchain/dependencies/CMakeLists.txt</a> for a CMake superbuild file that fetches and builds MFC's main dependencies with supported versions.</p>
<ul>
<li><b>Fetch MFC:</b></li>
</ul>
<div class="fragment"><div class="line">$ git clone https://github.com/MFlowCode/MFC</div>
<div class="line">$ cd MFC</div>
</div><!-- fragment --><ul>
<li>**(Optional) Configure MFC defaults in <a href="defaults.yaml">defaults.yaml</a>:**</li>
</ul>
<p>If you wish, you can override MFC's default build parameters in <a href="defaults.yaml">defaults.yaml</a>, a file intended for user customization. This can greatly reduce the number of command-line arguments you have to pass to <a href="mfc.sh">mfc.sh</a>` in the following sections. You can do this at any time.</p>
<ul>
<li><b>Build MFC's codes in <code>release-cpu</code> mode with 8 threads:</b></li>
</ul>
<div class="fragment"><div class="line">$ ./mfc.sh build -t pre_process simulation post_process -j 8</div>
</div><!-- fragment --><p>To build MFC in different configurations (herein, <em>modes</em>), the <code>-m &lt;mode&gt;</code> option can be specified to each call to <code>mfc.sh</code>. A full list of modes is located in <a href="defaults.yaml">defaults.yaml</a>. It can be modified to work with system, and additional modes can be created at your discretion. The default mode is <code>release-cpu</code> but you can use others such as <code>release-gpu</code>.</p>
<p><b>IMPORTANT NOTE</b>: This same mode will be used for any future commands such as <code>./mfc.sh test</code> and <code>./mfc.sh run</code> until you specify <code>-m</code> again (in any of these commands).</p>
<ul>
<li><b>Run MFC's tests in <code>release-cpu</code> mode with 8 threads:</b></li>
</ul>
<div class="fragment"><div class="line">$ ./mfc.sh test -j 8</div>
</div><!-- fragment --><p>Please refer to the <a href="#testing-mfc">Testing</a> section of this document for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
