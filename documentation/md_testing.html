<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MFC: Testing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
// This file is set as MATHJAX_CODEFILE in the Doxyfile. It configures how
// MathJax renders expressions in Markdown so that it is consistent with GitHub.
MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath:  [ ['$',  '$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true,
      ignoreClass: "line" // Ignore code blocks: https://web.archive.org/web/20120430100225/http://www.mathjax.org/docs/1.1/options/tex2jax.html
    },
    "HTML-CSS": {
      fonts: ["TeX"]
    }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MFC
   </div>
   <div id="projectbrief">High-fidelity multiphase flow simulation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_testing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Testing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To run MFC's test suite, run </p><div class="fragment"><div class="line">$ ./mfc.sh test -j &lt;thread count&gt;</div>
</div><!-- fragment --><p>It will generate and run test cases, comparing their output to that of previous runs from versions of MFC considered to be accurate. <em>golden files</em>, stored in the <code>tests/</code> directory contain this data, by aggregating <code>.dat</code> files generated when running MFC. A test is considered passing when our error tolerances are met, in order to maintain a high level of stability and accuracy. Run <code>./mfc.sh test -h</code> for a full list of accepted arguments.</p>
<p>Most notably, you can consult the full list of tests by running </p><div class="fragment"><div class="line">$ ./mfc.sh test -l</div>
</div><!-- fragment --><p>To restrict to a given range, use the <code>--from</code> (<code>-f</code>) and <code>--to</code> (<code>-t</code>) options. To run a (non-contiguous) subset of tests, use the <code>--only</code> (<code>-o</code>) option instead.</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Creating Tests</h2>
<p>To (re)generate <em>golden files</em>, append the <code>-g</code> (i.e <code>--generate</code>) option: </p><div class="fragment"><div class="line">$ ./mfc.sh test -g -j 8</div>
</div><!-- fragment --><p>It is recommended that a range be specified when generating golden files for new test cases, as described in the previous section, in an effort not to regenerate the golden files of existing test cases.</p>
<p>Adding a new test case can be done by modifying <a href="toolchain/mfc/tests/cases.py">cases.py</a>. The function <code>generate_cases</code> is responsible for generating the list of test cases. Loops and conditionals are used to vary parameters, whose defaults can be found in the <code>BASE_CFG</code> case object within <a href="toolchain/mfc/tests/case.py">case.py</a>. The function operates on two variables:</p>
<ul>
<li><code>stack</code>: A stack that holds the variations to the default case parameters. By pushing and popping the stack inside loops and conditionals, it is easier to nest test case descriptions, as it holds the variations that are common to all future test cases within the same indentation level (in most scenarios).</li>
<li><code>cases</code>: A list that holds fully-formed <code>Case</code> objects, that will be returned at the end of the function.</li>
</ul>
<p>Internally a test case is described as: </p><div class="fragment"><div class="line"><span class="preprocessor">@dataclasses.dataclass(init=False)</span></div>
<div class="line"><span class="keyword">class </span>Case:</div>
<div class="line">    trace:  str</div>
<div class="line">    params: dict</div>
<div class="line">    ppn:    int</div>
</div><!-- fragment --><p>where:</p><ul>
<li>The <code>trace</code> is a string that contains a human-readable description of what parameters were varied, or more generally what the case is meant to test. <b>Each <code>trace</code> must be distinct.</b></li>
<li><code>params</code> is the fully resolved case dictionary, as would appear in a Python case input file.</li>
<li><code>ppn</code> is the number of processes per node to use when running the case.</li>
</ul>
<p>To illustrate, consider the following excerpt from <code>generate_cases</code>:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> weno_order <span class="keywordflow">in</span> [3, 5]:</div>
<div class="line">  stack.push(f<span class="stringliteral">&quot;weno_order={weno_order}&quot;</span>, {<span class="stringliteral">&#39;weno_order&#39;</span>: weno_order})</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> mapped_weno, mp_weno <span class="keywordflow">in</span> [(<span class="stringliteral">&#39;F&#39;</span>, <span class="stringliteral">&#39;F&#39;</span>), (<span class="stringliteral">&#39;T&#39;</span>, <span class="stringliteral">&#39;F&#39;</span>), (<span class="stringliteral">&#39;F&#39;</span>, <span class="stringliteral">&#39;T&#39;</span>)]:</div>
<div class="line">      stack.push(f<span class="stringliteral">&quot;(mapped_weno={mapped_weno},mp_weno={mp_weno})&quot;</span>, {</div>
<div class="line">          <span class="stringliteral">&#39;mapped_weno&#39;</span>: mapped_weno,</div>
<div class="line">          <span class="stringliteral">&#39;mp_weno&#39;</span>:     mp_weno</div>
<div class="line">      })</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> <span class="keywordflow">not</span> (mp_weno == <span class="stringliteral">&#39;T&#39;</span> <span class="keywordflow">and</span> weno_order != 5):</div>
<div class="line">          cases.append(create_case(stack, <span class="stringliteral">&#39;&#39;</span>, {}))</div>
<div class="line"> </div>
<div class="line">      stack.pop()</div>
<div class="line"> </div>
<div class="line">  stack.pop()</div>
</div><!-- fragment --><p>When pushing to the stack, or creating a new case with the <code>create_case</code> function, you must specify:</p><ul>
<li><code>stack</code>: The current stack.</li>
<li><code>trace</code>: A human-readable string describing what you are currently varying.</li>
<li><code>variations</code>: A Python dictionary with case parameter variations.</li>
<li>(Optional) <code>ppn</code>: The number of processes per node to use (default is 1).</li>
</ul>
<p>If a trace is empty (that is, the empty string <code>""</code>), it will not appear in the final trace, but any case parameter variations associated with it will still be applied.</p>
<p>Finally, the case is appended to the <code>cases</code> list, which will be returned by the <code>generate_cases</code> function. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
